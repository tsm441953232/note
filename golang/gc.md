#Golang GC 三色标记法(基于标记-清除算法)

1.Mark and Sweep  
a.找出所有的引用对象，标记  
b.清除所有未标记的对象  
会有一个问题，stop the world, STW会暂停程序的所有执行，直到一次GC清理完成  

2.三色标记法  
a.process创建的所有对象在初始时全部标记成白色  
b.gc开始扫描所有能达到的对象，全部标记成灰色  
c.从所有灰色对象找出所有的引用对象，引用对象标记成灰色，自身(包括无引用对象的)变成黑色  
d.重复c直到所有灰色对象不存在  
e.清除所有白色对象，将所有对象恢复成白色重复a-e  

STW约在1ms以下

FAQ:  
Q: gc与用户逻辑如何并发？  
A: 三色标记法中最后只会剩下黑白两种颜色的对象，只清除白色的对象，不会影响用户逻辑，即清除与用户逻辑是并发的  

Q: 清除操作与用户逻辑并发，那么标记操作与用户逻辑即新创建对象时标记操作产生混乱？  
A: Golang为了解决这个问题，引入了hybrid write barrier(写屏障)，当用户逻辑新创建或者修改引用时，触发写屏障，向GC发送信号，会将其标记成灰色对象    

